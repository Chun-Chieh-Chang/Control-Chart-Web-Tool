# QIP 數據提取問題診斷指南

## 當前狀態

我已經在 `js/qip/processor.js` 中添加了詳細的診斷日誌。現在當您執行 QIP 數據提取時，瀏覽器 Console (F12) 會顯示完整的提取過程。

## 如何診斷問題

### 1. 準備測試數據
使用您提到的「1~16穴都在同一個工作表」的QIP報表進行測試。

### 2. 執行提取
1. 上傳檔案
2. 設定產品資訊與模穴數
3. 設定讀取範圍（例如）：
   - **Group 1**: Cavity ID = `K3:R3`, Data = `K4:R4`
   - **Group 2**: Cavity ID = `S3:Z3`, Data = `S4:Z4`
4. 點擊「開始提取」
5. **立即打開瀏覽器 Console (按 F12 鍵)**

### 3. 查看日誌

您會看到類似以下的詳細日誌：

```
[QIP] 提取穴組數據 - Cavity ID範圍: K3:R3, 數據範圍: K4:R4
[QIP][Row4] 檢查 A4="長度", isNumeric=false
[QIP][Row4] ✓ 找到檢驗項目: "長度"
[QIP][Row4] ✓ 提取成功: "長度", 穴號: [1, 2, 3, 4, 5, 6, 7, 8], 數量: 8

[QIP] 合併數據 - 項目: 長度, 批次: 200430D
  ├─ 現有穴號: [1, 2, 3, 4, 5, 6, 7, 8]
  ├─ 新增穴號: [9, 10, 11, 12, 13, 14, 15, 16]
  └─ 合併後總穴數: 16 (穴號: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16])
```

### 4. 檢查可能的問題

#### 問題 A：找不到檢驗項目名稱
如果看到：
```
[QIP][Row4] 檢查 A4="(空)", isNumeric=undefined
[QIP][Row4] ✗ 未找到檢驗項目名稱，跳過此行
[QIP][Row4] ✗ 有數據但無檢驗項目名稱！數據被丟棄，穴數: 8
```

**原因**：
- 檢驗項目名稱所在的儲存格（例如 A4）是空的
- 或者是合併儲存格，值沒有正確讀取

**解決方案**：
- 檢查 Excel 源文件，確認檢驗項目名稱確實在 A 欄或 B 欄
- 如果使用合併儲存格，確保值在合併範圍的左上角單元格

#### 問題 B：檢驗項目名稱被誤判為數字
如果看到：
```
[QIP][Row4] 檢查 A4="123", isNumeric=true
(跳過，因為被視為數字)
[QIP][Row4] ✗ 未找到檢驗項目名稱，跳過此行
```

**原因**：檢驗項目名稱是純數字（如 "123"）

**解決方案**：請提供實際的檢驗項目名稱格式，我可以調整判斷邏輯

#### 問題 C：相鄰項目只提取第二個
如果您的 QIP 報表格式類似：
```
Row 3: 1號穴  2號穴  ...  9號穴  10號穴   ...
Row 4: 長度   0.823  ...  0.821  0.825    ...
Row 5: 重量   1.245  ...  1.241  1.247    ...
```

並且您設定數據範圍為 `K4:R5` (涵蓋兩行)，那麼：
- Row 4 應該提取「長度」
- Row 5 應該提取「重量」

如果日誌顯示只提取了「重量」，請查看「長度」那一行的日誌，檢查是否有錯誤訊息。

### 5. 將日誌發送給我

請執行提取後，複製 Console 中所有以 `[QIP]` 開頭的日誌訊息，並告訴我：
1. 您看到了什麼錯誤或警告？
2. 哪個檢驗項目的數據丟失了？
3. Excel 源文件中該項目的實際位置（例如：檢驗項目名稱在 A4，數據在 K4:R4）

有了這些資訊，我就能精確定位並修復問題。

## 已知的設計限制

當前實現假設：
1. 檢驗項目名稱在數據範圍的**左側**（A 欄或 B 欄）
2. 穴號 ID 在數據範圍的**上方一行**
3. 每個 Group 的設定獨立（Group 1 和 Group 2 的數據會透過檢驗項目名稱來合併）

如果您的 QIP 報表格式與此不符，請提供實際的格式說明。

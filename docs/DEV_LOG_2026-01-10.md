# 開發日誌 (Development Log) - 2026-01-10

## 1. 執行摘要 (Executive Summary)
本日重點在於將系統從舊版圖表庫遷移至現代化的 SVG 架構 (ApexCharts)，同時保留原有的視覺識別標準。此外，今日最大的突破在於引入了「專家解讀系統 (Expert Knowledge System)」，將統計規則轉化為具體的現場行動指引，並大幅優化了檔案匯出與歷史紀錄功能。

## 2. MECE 工作成果細節 (Detailed Achievements)

### 2.1 核心視覺化與圖表工程 (Core Visualization & Charting)
*   **技術遷移**: 全面將 Canvas (Chart.js) 遷移至 SVG (ApexCharts)，解決了縮放模糊問題，提升了渲染效能。
*   **視覺還原 (Visual Parity)**:
    *   嚴格定義並還原了舊版配色系統：平均值(Blue-500)、目標值(Emerald-500)、規格界限(Red-500)。
    *   Cpk 圖表採用標準的三色燈號邏輯 (<1.0 紅, <1.33 黃, >1.33 綠)。
*   **數據格式化**:
    *   Cpk 軸座標統一為 3 位小數。
    *   Mean/Range/StdDev 軸座標統一為 4 位小數。
    *   隱藏了過度擁擠的 Data Labels，僅保留關鍵的 Tooltip 互動。

### 2.2 專家知識系統 (Expert System) - *New Feature*
*   **雙專家視角**: 針對 SPC 異常規則建立了解讀資料庫，包含：
    *   👷 **成型專家 (Molding Expert)**: 關聯至射嘴阻塞、模溫水路、原料變異、液壓系統等物理原因。
    *   👨‍🔬 **品管專家 (QC Expert)**: 關聯至可歸屬原因、抽樣風險、預防保養 (PM) 與操作手冊 (SOP)。
*   **Nelson Rules 覆蓋率**: 目前支援 Rule 1 ~ 6 (含 Rule 5 中度偏移 & Rule 6 早期預警) 的完整解讀。
*   **獨立視圖**: 新增左側導航入口與獨立的專家解讀頁面 (`view-nelson`)。
*   **即時輔助**: 在異常偵測列表 (Anomaly Sidebar) 實作了智慧懸停提示 (Rich Tooltip)。

### 2.3 功能功能增強 (Feature Enhancements)
*   **Excel 匯出引擎**:
    *   檔名邏輯優化: `SPC_Report_[ItemName]_[ModelType]_[Date].xlsx`。
    *   支援原生「另存新檔」對話框 (FileSystem Access API)，並提供自動降級 (Fallback) 機制。
    *   修復 Group Analysis 無法匯出數據的問題。
*   **歷史紀錄互動**: 修復 "View Log" 按鈕，現在可點擊查看該次分析的詳細 Metadata (檔案、時間、類型)。

### 2.4 使用者體驗與介面優化 (UX/UI Refinement)
*   **互動控制**: 實作「雙擊重置縮放 (Double-click to Reset Zoom)」功能，解決使用者迷失在局部視圖的問題 (`zoomX` logic)。
*   **介面修復**: 
    *   解決側邊欄 (`overflow: auto`) 導致 Tooltip 被遮擋的問題。
    *   解決方案：採用全域固定定位 (`fixed position`, `z-index: 9999`) 並透過 JS 動態計算座標。
*   **導航修復**: 修正 JS 路由邏輯 (`switchView`)，確保新增的頁面能正確切換與隱藏。

## 3. 檔案結構狀態 (File Structure Status)
*   **核心邏輯**: `js/app.js` (已整合所有 SPC 邏輯、圖表設定、UI 交互)。
*   **入口頁面**: `index.html` (已包含全域 Tooltip 容器與新導航結構)。
*   **備份檔案**: `js/*_old.js` 等檔案為舊版備份，目前系統已不再依賴它們。

## 4. 下一步建議 (Next Steps)
*   考量可以將 `NelsonRules` 字典提取為獨立的 JSON 配置檔，便於未來維護或多語言擴展。
*   專家系統可進一步與歷史數據結合，自動標記高頻發生的異常類型。

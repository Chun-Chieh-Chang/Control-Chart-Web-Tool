# 開發失敗紀錄、原因# 失效分析與矯正措施 (Failure Analysis & Corrective Actions)

## [2026-02-06] 專案頁面寬度不一致 (Layout Inconsistency)

- **現象**: 「QIP 提取」頁面與「分析設定」頁面的寬度限制分別為 `7xl` 與 `5xl`，與儀表板的 `96%` 不同，導致切換頁面時視覺出現跳動。
- **根因**: 不同功能模組由不同開發階段產出，未在開發初期定義全域容器規範。
- **矯正措施**: 將所有主要視圖容器標記為 `max-w-[96%]`，確保切換時左右邊界對齊。
- **驗證**: 已推送至 GitHub Pages 驗證一致性。

## [2026-02-06] 上傳區域佈局重心失調 (UI Imbalance)

- **現象**: 初始上傳卡片佔據 2/3 寬度且高度過大，在 Dark Mode 下產生過多「死亡留白」，給人未完工的視覺感。
- **根因**: 傳統 Dashboard 佈局未考慮資訊密度平衡，將單一功能塊放得過大。
- **矯正措施**: 改為「三欄式對稱佈局」，併入「近期活動」與「作業規範」，提升資訊價值密度。
- **驗證**: 已實施並獲得用戶認可。

## [2026-02-06] Minitab 專業風格轉型失敗 (Thematic Backtrack)

- **現象**: 嘗試移除所有吉卜力色彩與圓角以模擬 Minitab 專業質感，但成果顯得「單薄」且「缺乏工程師以外的親和力」。
- **根因**: 專業感不代表簡陋。在沒有精緻排版設計師介入的情況下，過度簡化會讓既有的視覺層次崩塌。
- **矯正措施**: 放棄純 Minitab 風格，回歸吉卜力主題，但進行「專業化收斂」：縮減邊界圓角、標準化間距、提升資料表格權重。
- **驗證**: 確定以「精緻吉卜力」為最終風格基底。

## [2026-02-06] 群組趨勢圖表顯示失效

- **現象**: X 軸批號標籤完全重疊無法辨識；數據集中在頂部，底部大量空白；標記點過於密集導致視覺混亂。
- **根因**:
  1. `xaxis.labels` 缺少旋轉與重疊處理配置。
  2. `yaxis` 默認從 0 開始且未根據動態數據調整範圍。
  3. `markers.size` 未根據數據量進行動態調整。
- **矯正措施**:
  1. 引入動態 Y 軸範圍計算邏輯。
  2. 設置 X 軸標籤旋轉 -45 度並開啟 `hideOverlappingLabels`。
  3. 實施標記點閾值控制（>50點隱藏）。
- **驗證**: 已通過數據測試套件。

---

本文件依據開發階段遭遇的技術困難、邏輯錯誤及系統限制進行分類紀錄，旨在避免未來新案重複發生類似錯誤。

## 1. 執行環境與指令類 (Environment & Commands)

### 1.1 PowerShell 鏈接指令失敗

- **失敗現象**：使用 `git add . && git commit` 時報錯，提示 `&&` 不是有效的陳述式分隔符號。
- **原因分析**：執行環境為 Windows PowerShell，而 `&&` 是 Linux/Unix Bash 或 CMD 的語法，PowerShell 預設不支援此符號進行命令鏈接。
- **矯正措施**：改用分號 `;` 分隔命令，或將任務拆分為多個獨立的 `run_command` 呼叫。

### 1.2 自動化瀏覽器工具 (Subagent) 無法啟動

- **失敗現象**：嘗試呼叫 `browser_subagent` 進行 UI 驗證時，回報 `$HOME environment variable is not set` 錯誤。
- **原因分析**：執行環境配置不完整，導致 Playwright 無法建立必要的快取路徑與啟動核心二進位檔案。
- **矯正措施**：
  1. 轉向**靜態代碼分析 (Static Code Analysis)**，通過 `node --check` 驗證語法。
  2. 使用 `view_file` 與 `grep_search` 進行「人工邏輯走讀 (Logic Walkthrough)」。
  3. 利用 `replace_file_content` 的前後文比對確保模板與事件綁定閉合。
- **最新狀態記錄 [2026-02-16]**：在執行「智慧選取」開發時再次遭遇此限。已通過手動語法檢測與邏輯閉環驗證完成交付，確保即便無實體瀏覽器渲染，代碼產出依然具備最高健壯性。

---

## 2. 邏輯實作與語法類 (Logic & Syntax)

### 2.1 JavaScript 類別閉合標記 (Braces) 偏移

- **失敗現象**：在大規模重構 `processor.js` 後，出現 `Identifier expected` 或 `typeof is a reserved word` 錯誤。
- **原因分析**：在取代多行程式碼塊時，誤刪了類別或函數的收尾花括號 `}`，導致類別定義提前結束，後續的方法變成了全域代碼（Invalid Global Scope）。
- **矯正措施**：
  1.  實施修改前，使用 `view_file` 確保能看見完整的閉合區段。
  2.  對類別尾部實施「整體校驗」，確保 `class { ... }` 結構完整性。
  3.  使用 `multi_replace_file_content` 進行分區精確修改，而非單次覆蓋超長區域。

### 2.2 多檔案批號合併邏輯衝突

- **失敗現象**：初始合併邏輯僅以「名稱」判斷，導致不同檔案中的 `Setup` 批次會被合併在一起，丟失獨立性。
- **原因分析**：未考慮到「相同名稱可能來自不同物理檔案」的情境。
- **矯正措施**：引入 `workbookId` (或檔案索引) 做為判斷維度。合併邏輯改為：`同檔案 + 基準名稱相同 = 合併`；`不同檔案 = 獨立保存`。

---

## 3. 輸出格式與相容性類 (Export & Compatibility)

### 3.1 Excel 座標位移導致工具解析失敗

- **失敗現象**：為了追求「美觀」將產品資訊動態放在末尾，導致使用固定座標（如 B5/B6）讀取的舊有 VBA 工具無法抓取到產品名稱。
- **原因分析**：開發者過於關注「動態排版」而忽略了「固定座標讀取」的系統相容性。
- **矯正措施**：重構 `ExcelExporter` 矩陣，強制將 `ProductName` 固定在 A5/B5，`MeasurementUnit` 固定在 A6/B6。透過 AOA (Array of Arrays) 預先墊空行，確保這兩格與右側數據流共存而不位移。

### 3.2 數據中間空行導致資料斷層

- **失敗現象**：初始為了隔離標頭與數據，在中間插入了空行，導致自動化分析軟體在讀取時判定為「資料結束」。
- **原因分析**：對資料匯入端（Import Engine）的「連續性檢查」機制瞭解不足。
- **矯正措施**：移除所有人工插入的空行。數據流、批號、規格標籤應從 Row 2 開始緊密依序往下排列，規格僅保留首行記載。

---

## 4. UI/UX 視覺感知類 (Aesthetics)

### 4.1 垂直批號字體比重失調

- **失敗現象**：批號旋轉 180 度且使用 14px 粗體，在窄螢幕下會強烈擠壓量測數值的可視區域。
- **原因分析**：垂直字體 (Vertical-rl) 在視覺上的高度遠大於寬度，大字體會導致工作表變得異常「細長」。
- **矯正措施**：與使用者確認後，將字體縮小至 **12px** 並微調字距 (`letter-spacing: 0.5px`)，在可讀性與排版密度間取得平衡。

---

## 總結與矯正機制 (Summary)

後續開發應遵循：

1. **先複述、再修改**：涉及介面座標或數據結構變動時，必須先向使用者覆核邏輯描述。
2. **小步快跑**：避免單次修改超過 500 行代碼，降低括號閉合錯誤的風險。
3. **固定座標優先**：凡涉及 Excel 資料交換，固定座標（Fixed Location）的優先級高於動態排版。

# SPC 製程能力計算邏輯說明

## 概述

本文件說明 Cpk/Ppk 製程能力指數的標準計算方法，適用於多模穴射出成型品質分析。

---

## 核心公式

### Cpk (製程能力指數)

```
Cpk = min[ (USL - μ) / 3σ_within, (μ - LSL) / 3σ_within ]
```

- 反映**短期製程能力**
- 考慮製程中心偏移
- 使用**組內標準差** (σ_within)

### Ppk (製程績效指數)

```
Ppk = min[ (USL - μ) / 3σ_overall, (μ - LSL) / 3σ_overall ]
```

- 反映**長期製程績效**
- 使用**整體標準差** (σ_overall)

---

## 標準差計算

### σ_within (組內標準差)

```
σ_within = R̄ / d₂
```

| 參數 | 說明 |
|------|------|
| R̄ | 各子組全距 (Max - Min) 的平均值 |
| d₂ | 依子組大小 n 查表的控制圖常數 |

### σ_overall (整體標準差)

```
σ_overall = √[ Σ(xᵢ - μ)² / (N-1) ]
```

- 使用**所有原始數據點**計算
- 不區分子組/批次

---

## d₂ 常數對照表 (n = 2 ~ 48)

| n | d₂ | n | d₂ | n | d₂ | n | d₂ |
|---|-----|---|-----|---|-----|---|-----|
| 2 | 1.128 | 14 | 3.407 | 26 | 3.964 | 38 | 4.280 |
| 3 | 1.693 | 15 | 3.472 | 27 | 3.997 | 39 | 4.301 |
| 4 | 2.059 | 16 | 3.532 | 28 | 4.027 | 40 | 4.322 |
| 5 | 2.326 | 17 | 3.588 | 29 | 4.057 | 41 | 4.341 |
| 6 | 2.534 | 18 | 3.640 | 30 | 4.086 | 42 | 4.361 |
| 7 | 2.704 | 19 | 3.689 | 31 | 4.113 | 43 | 4.379 |
| 8 | 2.847 | 20 | 3.735 | 32 | 4.139 | 44 | 4.398 |
| 9 | 2.970 | 21 | 3.778 | 33 | 4.165 | 45 | 4.415 |
| 10 | 3.078 | 22 | 3.819 | 34 | 4.189 | 46 | 4.433 |
| 11 | 3.173 | 23 | 3.858 | 35 | 4.213 | 47 | 4.450 |
| 12 | 3.258 | 24 | 3.895 | 36 | 4.236 | 48 | 4.466 |
| 13 | 3.336 | 25 | 3.931 | 37 | 4.259 | | |

---

## 判讀標準

| Cpk/Ppk | 等級 | 說明 |
|---------|------|------|
| ≥ 1.67 | 🟢 優異 | 製程高度穩定，不良率極低 |
| ≥ 1.33 | 🟢 良好 | 製程穩定，符合多數客戶要求 |
| ≥ 1.00 | 🟡 可接受 | 製程尚可，但存在改善空間 |
| < 1.00 | 🔴 需改善 | 製程能力不足，需立即改善 |

---

## 多模穴分析說明

### 子組定義
- **子組 (Subgroup)**: 同一批次中各模穴的測量值
- **子組大小 n**: 模穴數量 (例: 4 穴模具 → n = 4)

### 數據結構

```
批次 1: [穴1, 穴2, 穴3, 穴4] → 一個子組
批次 2: [穴1, 穴2, 穴3, 穴4] → 一個子組
...
```

### 計算流程

1. 計算各批次的全距 R = Max - Min
2. 計算 R̄ = 所有批次全距的平均值
3. 查表取得 d₂ (依模穴數)
4. σ_within = R̄ / d₂
5. μ = 所有原始數據的平均值
6. σ_overall = 所有原始數據的標準差
7. 代入公式計算 Cpk 與 Ppk

---

## 多模穴平衡性分析 (Cavity Balance Analysis)

針對多模穴射出成型，除各別穴位的 Cpk 外，模穴間的平衡性是判定「模具設計」或「射出條件」優劣的關鍵。

### 平衡性指標 (Imbalance Ratio)

```
不平衡率 (%) = (模穴均值之全距 / 總公差) × 100%
```

- **模穴均值之全距**: 所有模穴中，平均值最大者與最小者之差。
- **總公差**: USL - LSL。

### 判定標準

| 不平衡率 | 狀態 | 智慧診斷建議 |
|---------|------|------------|
| < 10% | 🟢 優異 | 模穴平衡良好，製程穩定。 |
| 10% ~ 25% | 🟡 尚可 | 偵測到輕微不平衡，建議檢查流道平衡或模溫。 |
| > 25% | 🔴 不佳 | 嚴重不平衡！建議優先進行模具維護或熱流道調整。 |

---

## 計算邏輯合理性探討 (Expert Interpretation)

本專案採用之計算邏輯符合業界通用標準 (AIAG SPC)，但在多模穴情境下需注意以下解讀要點：

1. **Cpk 與 Ppk 的差異**：
   - **Cpk (短期能力)**：反映機台在極短時間內的重複精度。若 Cpk 高但 Ppk 低，通常是批次間的漂移（如原料批次、環境溫濕度）過大。
   - **Ppk (長期績效)**：這是客戶最終收到的產品品質最誠實的反映。

2. **高模穴數 (n > 10) 的 d₂ 限制**：
   - 當模穴數很大（如 48 穴）時，全距 (Range) 對變異的估算敏感度會下降。若發現 Cpk 異常偏低，建議搭配「穴號分析」觀察是否為特定模穴拉低整體表現。

3. **模穴不平衡的陷阱**：
   - 若模具流道平衡不佳，各穴均值會有固定偏差。這種「固定偏差」在批次分析中會被計入變異中，導致 Cpk 指數被低估。此時應參考「模穴平衡性分析」來判斷是「調機問題」還是「模具問題」。

---

## 三方交叉驗證與矛盾排除 (Cross-Model Triangulation)

在實務中，不同的分析模式可能會產生看似矛盾的結論。理解這些矛盾是找出問題根源（Root Cause）的最佳機會。

### 矛盾場景分析

| 矛盾現象 | 統計真相 | 優先參考模型 | 行動建議 |
| :--- | :--- | :--- | :--- |
| **批次 Cpk 差，但模穴 Cpk 好** | **模穴不平衡**。各穴自身穩定，但彼此中心點偏移過大。 | **模穴分析** | 停止調機，優先進行修模或流道調整。 |
| **批次管制圖穩定，但群組變異劇烈** | **Shot-to-Shot 不穩**。整體平均值雖在範圍內，但每模次的穩定度正在惡化。 | **群組分析** | 檢查原料穩定度、止逆環磨損或射出壓力切換點。 |
| **Cpk 高，但 Ppk 極低** | **長期漂移**。製程短期內非常精準，但隨時間有明顯走勢（如溫升）。 | **批次分析 (Ppk)** | 檢查冷卻系統效能或環境溫濕度補償。 |

### 專家診斷優先級 (Priority Hierarchy)

當結論不一致時，請遵循以下邏輯鏈進行決策：

1.  **空間維度優先 (Spatial First)**：先確保 `模穴平衡`。若不平衡，所有整體的指標（如批次 Cpk）都是被污染的數據。
2.  **穩定度優先 (Stability First)**：參考 `群組分析`。如果每一模次之間的變異無法控制，談論中心值（Mean）的偏移是沒有意義的。
3.  **實體績效為準 (Performance Final)**：無論過程如何，`Ppk` 是反映交付給客戶產品的最終真實品質指標。

---

## 群組穩定度分析 (Group Stability Analysis)

針對群組分析模式，系統會評估各組間變異（Range）的一致性，以判斷製程是否存在長期的不穩定因素。

### 變異一致性得分 (Consistency Score)

```
一致性得分 (%) = (全距之標準差 / 平均全距) × 100%
```

- **得分 < 20%**: 🟢 **穩定**。各組數據跳動一致，製程控制良好。
- **得分 20% ~ 40%**: 🟡 **起伏**。製程穩定度有所波動，需注意原料或環境干預。
- **得分 > 40%**: 🔴 **不穩定**。組間變異劇烈，表示製程存在嚴重的特殊原因干擾（例如某幾批數據特別發散）。

---

## 變異源診斷 (Variance Source Diagnosis)

系統透過比對 Cpk 與 Ppk 的落差，自動判定製程波動的主要來源。

### 穩定度指數 (Stability Index, St)

```
St = Ppk / Cpk
```

- **St ≥ 0.8**: 表示製程波動主要來自**組內 (Within-Shot)**，即模穴差異或單次注射內的波動。
- **St < 0.8**: 表示製程波動主要來自**批次間 (Shot-to-Shot)**，即機台穩定度、原料變動或環境影響。

---

## 數據分佈健康度 (Distribution Health Check)

標準 SPC 計算假設數據符合常態分佈。若數據分佈異常，Cpk 的參考價值將大幅下降。

- **偏度 (Skewness)**: 衡量分佈的不對稱性。若 $|Skewness| > 1$，表示數據嚴重偏斜（可能因單向受限或多穴差異引起），Cpk 可能存在誤差。
- **峰度 (Kurtosis)**: 衡量分佈的尖銳程度。異常的峰度表示數據中存在過多極端值或數據過於集中。

---

## 參考標準

- ISO 22514-2: Statistical methods in process management
- AIAG SPC Manual (Automotive Industry Action Group)
- Montgomery, D.C. "Introduction to Statistical Quality Control"

---

*文件版本: 2026-01-29*

<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SPC Statistical Process Control Analysis Tool - Web-based QIP analysis">
    <title>SPC Analysis Tool | QIP 統計製程管制分析系統</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4f46e5', // Indigo 600
                        'primary-light': '#818cf8',
                        danger: '#f43f5e', // Rose 500
                        success: '#10b981', // Emerald 500
                        surface: '#ffffff',
                        background: '#f8fafc', // Slate 50
                        'border-light': '#f1f5f9', // Slate 100
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <!-- Custom Styles & SaaS Aesthetic -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            background-color: #f8fafc;
            color: #1e293b;
        }

        /* SaaS Card Style */
        .saas-card {
            background: #ffffff;
            border: 1px solid #f1f5f9;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.05), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            border-radius: 12px;
            transition: all 0.2s ease;
        }

        .saas-card:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        /* Anomaly Pulse Animation */
        @keyframes pulse-red {
            0% {
                transform: scale(1);
                opacity: 0.8;
                box-shadow: 0 0 0 0 rgba(244, 63, 94, 0.7);
            }

            70% {
                transform: scale(1.2);
                opacity: 1;
                box-shadow: 0 0 0 10px rgba(244, 63, 94, 0);
            }

            100% {
                transform: scale(1);
                opacity: 0.8;
                box-shadow: 0 0 0 0 rgba(244, 63, 94, 0);
            }
        }

        .anomaly-pulse {
            animation: pulse-red 2s infinite;
            background-color: #f43f5e;
            border-radius: 50%;
        }

        /* Loading Spinner */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(4px);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 9999;
        }

        .spinner {
            border: 3px solid #f1f5f9;
            border-top: 3px solid #6366f1;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #f8fafc;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>

    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
</head>

<body class="font-sans antialiased text-gray-100 flex h-screen overflow-hidden bg-[#1a1f3c]">

    <!-- Sidebar removed -->

    <!-- Main Content -->
    <main class="flex-1 bg-slate-50 overflow-y-auto relative">
        <div class="p-8 max-w-7xl mx-auto h-full flex flex-col">

            <!-- Page Header -->
            <header class="mb-6 flex justify-between items-end">
                <div>
                    <h2 class="text-2xl font-bold tracking-tight text-slate-800" data-en="Analysis Workspace"
                        data-zh="統計分析工作區">統計分析工作區</h2>
                    <p class="text-slate-500 mt-1 text-sm"
                        data-en="Upload documents to generate real-time SPC insights." data-zh="上傳報表以產生即時 SPC 數據洞察。">
                        上傳報表以產生即時 SPC 數據洞察。</p>
                </div>
                <!-- Language Toggle Button relocated here -->
                <button id="langBtn"
                    class="bg-white hover:bg-slate-50 text-slate-700 px-4 py-2 rounded-lg transition-all flex items-center space-x-2 border border-slate-200 shadow-sm"
                    title="Switch Language">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-slate-400" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" />
                    </svg>
                    <span id="langText" class="font-medium text-xs tracking-wider">EN</span>
                </button>
            </header>

            <!-- STEP 1: Upload Zone -->
            <section id="step1">
                <div class="relative rounded-2xl p-[1px] bg-slate-200 shadow-sm mb-10 overflow-hidden">
                    <div class="rounded-[15px] bg-white p-10 text-center w-full flex flex-col items-center justify-center gap-4 hover:bg-slate-50 transition-colors cursor-pointer"
                        id="uploadZone">

                        <input type="file" id="fileInput" accept=".xlsx,.xls" hidden>

                        <div class="w-14 h-14 rounded-2xl bg-indigo-50 flex items-center justify-center mb-2">
                            <svg class="w-7 h-7 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                            </svg>
                        </div>

                        <h3 class="text-lg text-slate-800 font-semibold" data-en="Import Data File" data-zh="導入數據檔案">
                            導入數據檔案</h3>
                        <p class="text-xs text-slate-400" data-en="Drag & drop your Excel report here or browse"
                            data-zh="拖曳 Excel 報表至此，或點擊瀏覽">拖曳 Excel 報表至此，或點擊瀏覽</p>
                    </div>
                </div>

                <!-- File Info (Hidden initially) -->
                <div class="glass-card rounded-xl p-6 flex justify-between items-center" id="fileInfo"
                    style="display: none;">
                    <div class="flex items-center space-x-4">
                        <div
                            class="w-10 h-10 rounded-full bg-green-500/20 text-green-400 flex items-center justify-center">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5 13l4 4L19 7"></path>
                            </svg>
                        </div>
                        <div>
                            <p class="text-gray-200 font-medium" id="fileName">Filename.xlsx</p>
                            <p class="text-xs text-gray-400" data-en="Ready for analysis" data-zh="準備分析">準備分析</p>
                        </div>
                    </div>
                    <button id="resetBtn"
                        class="text-gray-400 hover:text-white text-sm underline decoration-gray-500 underline-offset-4"
                        data-en="Change File" data-zh="更換檔案">更換檔案</button>
                </div>
            </section>

            <!-- STEP 2: Inspection Item Selection -->
            <section id="step2" style="display: none;" class="mb-12">
                <div class="glass-card rounded-xl p-8">
                    <h3 class="text-xl font-semibold text-gray-100 mb-6 border-l-4 border-indigo-500 pl-4"
                        data-en="Select Inspection Item" data-zh="選擇檢驗項目">選擇檢驗項目</h3>
                    <div id="itemList" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                        <!-- Items injected by JS -->
                    </div>
                </div>
            </section>

            <!-- STEP 3: Analysis Type -->
            <section id="step3" style="display: none;" class="mb-12">
                <div class="glass-card rounded-xl p-8">
                    <h3 class="text-xl font-semibold text-gray-100 mb-6 border-l-4 border-indigo-500 pl-4"
                        data-en="Select Analysis Type" data-zh="選擇分析類型">選擇分析類型</h3>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- Batch Analysis -->
                        <div class="analysis-card bg-white/5 hover:bg-white/10 p-6 rounded-xl border border-white/10 cursor-pointer transition-all hover:-translate-y-1 group"
                            data-type="batch">
                            <div
                                class="w-12 h-12 rounded-lg bg-blue-500/20 text-blue-400 flex items-center justify-center mb-4 group-hover:bg-blue-500 group-hover:text-white transition-colors">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z">
                                    </path>
                                </svg>
                            </div>
                            <h4 class="text-lg font-bold text-white mb-2" data-en="Batch Analysis" data-zh="批號分析">批號分析
                            </h4>
                            <p class="text-sm text-gray-400 mb-6" data-en="X-Bar R Charts + Capability"
                                data-zh="X-Bar R 管制圖 + 製程能力">X-Bar R 管制圖 + 製程能力</p>
                            <button
                                class="w-full py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg font-medium transition-colors"
                                data-analysis="batch" data-en="Execute" data-zh="執行分析">執行分析</button>
                        </div>

                        <!-- Cavity Analysis -->
                        <div class="analysis-card bg-white/5 hover:bg-white/10 p-6 rounded-xl border border-white/10 cursor-pointer transition-all hover:-translate-y-1 group"
                            data-type="cavity">
                            <div
                                class="w-12 h-12 rounded-lg bg-pink-500/20 text-pink-400 flex items-center justify-center mb-4 group-hover:bg-pink-500 group-hover:text-white transition-colors">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </div>
                            <h4 class="text-lg font-bold text-white mb-2" data-en="Cavity Analysis" data-zh="模穴分析">模穴分析
                            </h4>
                            <p class="text-sm text-gray-400 mb-6" data-en="Comparisons + Cp/Cpk"
                                data-zh="模穴比較 + Cp/Cpk">模穴比較 + Cp/Cpk</p>
                            <button
                                class="w-full py-2 bg-pink-600 hover:bg-pink-500 text-white rounded-lg font-medium transition-colors"
                                data-analysis="cavity" data-en="Execute" data-zh="執行分析">執行分析</button>
                        </div>

                        <!-- Group Analysis -->
                        <div class="analysis-card bg-white/5 hover:bg-white/10 p-6 rounded-xl border border-white/10 cursor-pointer transition-all hover:-translate-y-1 group"
                            data-type="group">
                            <div
                                class="w-12 h-12 rounded-lg bg-yellow-500/20 text-yellow-400 flex items-center justify-center mb-4 group-hover:bg-yellow-500 group-hover:text-white transition-colors">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z">
                                    </path>
                                </svg>
                            </div>
                            <h4 class="text-lg font-bold text-white mb-2" data-en="Group Analysis" data-zh="群組分析">群組分析
                            </h4>
                            <p class="text-sm text-gray-400 mb-6" data-en="Min-Max-Avg Charts"
                                data-zh="Min-Max-Avg 管制圖">Min-Max-Avg 管制圖</p>
                            <button
                                class="w-full py-2 bg-yellow-600 hover:bg-yellow-500 text-white rounded-lg font-medium transition-colors"
                                data-analysis="group" data-en="Execute" data-zh="執行分析">執行分析</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Results -->
            <section id="results" style="display: none;" class="mb-12">
                <div class="glass-card rounded-xl p-2">
                    <div class="flex justify-between items-center p-6 border-b border-white/10">
                        <h3 class="text-xl font-semibold text-gray-100" data-en="Analysis Results" data-zh="分析結果">分析結果
                        </h3>
                        <button id="downloadExcel"
                            class="flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-500 text-white rounded-lg text-sm font-medium transition-colors">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                            </svg>
                            <span data-en="Download Excel" data-zh="下載 Excel">下載 Excel</span>
                        </button>
                    </div>
                    <div class="p-6 overflow-x-auto" id="resultsContent">
                        <!-- Results injected by JS -->
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Right Sidebar: Anomaly Insights (Hidden by default) -->
    <aside id="anomalySidebar" class="w-80 bg-[#1e293b] border-l border-gray-700/30 flex flex-col hidden">
        <div class="p-6 border-b border-gray-700/30 bg-[#2b3252]/50 backdrop-blur-md">
            <h3 class="font-bold text-gray-100 flex items-center gap-2">
                <span class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></span>
                <span data-en="Anomaly Insights" data-zh="異常洞察">異常洞察</span>
            </h3>
        </div>
        <div class="flex-1 overflow-y-auto p-4 space-y-3" id="anomalyList">
            <!-- Anomaly Cards injected here -->
            <div class="text-center text-gray-500 mt-10">
                <p data-en="No anomalies detected" data-zh="未檢測到異常">未檢測到異常</p>
            </div>
        </div>
    </aside>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner mb-4"></div>
        <p id="loadingText" class="text-white text-lg font-light tracking-widest" data-en="Processing..."
            data-zh="處理中...">處理中...</p>
    </div>

    <!-- Scripts -->
    <script src="js/spc-all.js"></script>
</body>

</html>